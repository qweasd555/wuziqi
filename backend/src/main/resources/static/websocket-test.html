<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>WebSocket STOMP 测试</title>
</head>
<body>

<h2>WebSocket / Game 测试</h2>

<button onclick="connect()">连接 WebSocket</button>
<button onclick="sendMove()">发送落子</button>

<pre id="log"></pre>

<!-- SockJS + STOMP -->
<script src="https://cdn.jsdelivr.net/npm/sockjs-client/dist/sockjs.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/stompjs/lib/stomp.min.js"></script>

<script>
let stompClient = null;

function log(msg) {
    document.getElementById("log").textContent += msg + "\n";
}

function connect() {
    const socket = new SockJS("/ws-stomp");  // ★ 正确写法
    stompClient = Stomp.over(socket);

    stompClient.connect({}, function() {
        log("STOMP 已连接");

        stompClient.subscribe("/topic/game", function(msg) {
            log("收到广播：" + msg.body);
        });
    });
}

function sendMove() {
    if (!stompClient) {
        log("未连接 WebSocket");
        return;
    }

    const move = {
        x: 3,
        y: 3,
        userId: "123"
    };

    stompClient.send("/app/game/move", {}, JSON.stringify(move));
    log("已发送落子");
}
</script>

</body>
</html>
