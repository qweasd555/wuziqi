<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>WebSocket STOMP 测试</title>
</head>
<body>
<h2>WebSocket / Game 测试</h2>

<button onclick="connect()">连接 WebSocket</button>
<button onclick="sendMove()">发送落子</button>

<pre id="log"></pre>

<script src="https://cdn.jsdelivr.net/npm/sockjs-client@1/dist/sockjs.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/stompjs@2.3.3/lib/stomp.min.js"></script>

<script>
let stompClient = null;

function log(msg) {
    document.getElementById("log").textContent += msg + "\n";
}

function connect() {
    const socket = new SockJS("http://localhost:8080/ws-stomp");
    stompClient = Stomp.over(socket);

    stompClient.connect({}, function() {
        log("WebSocket 已连接！");

        stompClient.subscribe("/topic/game", function(message) {
            log("收到广播消息: " + message.body);
        });
    });
}

function sendMove() {
    if (!stompClient) {
        log("尚未连接 WebSocket");
        return;
    }

    let move = {
        x: 3,
        y: 3,
        userId: "user123"
    };

    stompClient.send("/app/game/move", {}, JSON.stringify(move));
    log("已发送落子消息");
}
</script>

</body>
</html>
