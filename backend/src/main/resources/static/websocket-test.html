<!DOCTYPE html>
<html>
<head>
    <title>简单WebSocket测试</title>
    <meta charset="UTF-8">
</head>
<body>
    <h1>简单WebSocket测试</h1>
    <div>
        <button onclick="connect()">连接</button>
        <button onclick="disconnect()">断开</button>
        <button onclick="sendPing()">发送Ping</button>
    </div>
    <div id="messages"></div>

    <script>
        let socket = null;
        
        function connect() {
            console.log("尝试连接WebSocket...");
            socket = new WebSocket('ws://localhost:8080/ws?userId=simpleTest');
            
            socket.onopen = function(event) {
                console.log('WebSocket连接已建立');
                addMessage('连接已建立');
            };
            
            socket.onmessage = function(event) {
                console.log('收到消息:', event.data);
                addMessage('收到消息: ' + event.data);
            };
            
            socket.onclose = function(event) {
                console.log('WebSocket连接已关闭');
                addMessage('连接已关闭');
            };
            
            socket.onerror = function(error) {
                console.error('WebSocket错误:', error);
                addMessage('错误: ' + error);
            };
        }
        
        function disconnect() {
            if (socket !== null) {
                socket.close();
                socket = null;
            }
        }
        
        function sendPing() {
            if (socket && socket.readyState === WebSocket.OPEN) {
                socket.send(JSON.stringify({ 
                    type: 'ping', 
                    userId: 'simpleTest',
                    timestamp: new Date().getTime()
                }));
                addMessage('发送Ping消息');
            } else {
                addMessage('WebSocket未连接');
            }
        }
        
        function addMessage(message) {
            const messagesDiv = document.getElementById('messages');
            const messageElement = document.createElement('div');
            messageElement.textContent = new Date().toLocaleTimeString() + ': ' + message;
            messagesDiv.appendChild(messageElement);
        }
    </script>
</body>
</html>